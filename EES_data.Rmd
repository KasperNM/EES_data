---
title: "EES_data"
author: "Kasper"
date: "25/05/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Loading in data from 2009
#Downloading Haven package to load in SAV file
library(haven)
library(tidyverse)
install.packages("googleLanguageR")
install.packages("cld2")
library(googleLanguageR)
library(cld2)

subset_2019$language_code = 0

for (i in 1:nrow(subset_2019)){
  if (subset_2019$hCountry!=18){
    subset_2019$language_code[i] <- detect_language(subset_2019$Q1_1[i], plain_text = FALSE, lang_code = TRUE)
  }
  else {
    subset_2019$language_code[i] <- "lt"
  }
  
}

?detect_language

for (i in 1:5000){
  #print(subset_2019$Q1_1[i])
  subset_2019$language_code[10000+i] <- detect_language(subset_2019$Q1_1[10000+i], plain_text = FALSE, lang_code = TRUE)
}

test1 <- subset(subset_2019[16500:17000,])

for (i in 1:2500){
  #print(subset_2019$Q1_1[i])
  subset_2019$language_code[15000+i] <- detect_language(subset_2019$Q1_1[15000+i], plain_text = FALSE, lang_code = TRUE)
}

print(subset_2019$language_code[12005])

for (i in 1:500){
  #print(test1$Q1_1[i])
  test1$language_code[i] <- detect_language(test1$Q1_1[i], plain_text = FALSE, lang_code = TRUE)
}

#17036

gl_auth("google_api_auth.json")
#<- detect_language(subset_2019$Q1_1[i], plain_text = TRUE, lang_code = TRUE)
#detect_language(subset_2019$Q1_1[4], plain_text = TRUE, lang_code = TRUE)

df_2009 = read_sav("ZA5055_v1-1-1.sav")
df_2019 = read_sav("ZA7581_v2-0-1.sav")

subset_2019 = select(df_2019, "Q1_1", "Q2", "hCountry")
subset_2019$dummyVariable <- 0
subset_new2019 <- subset(subset_2019[1:1000,])

str(subset_new2019)

str(subset_2009)

attributes(subset_2009$q1)

install.packages("labelled")


??write.xlsx

getwd()

write_excel_csv(subset_new2019,"/Users/kaspermichelsen/EES_data/test.xlsx")

df_2004 = read_sav("ZA4566.sav")

subset_2009 = select(df_2009, "t201c", "q1", "t100", "q4")
str(subset_2009)
options(scipen = n)
format(df_2009$t100[3], scientific = FALSE)

getGoogleLanguages()

test2 <- read_csv("test - test.csv")
```

```{r}
#2009
#Loading in data from 2009
#Downloading Haven package to load in SAV file
library(haven)
library(tidyverse)
df_2009 = read_sav("ZA5055_v1-1-1.sav")
#Make a subset with columns (ID, q1, country, party to help with q1)
subset_2009 = select(df_2009, "t201c", "q1", "t100", "q4", "q2", "q3")

#Create a new empty column for the name of the parties
subset_2009$partyname <- 0

#extracting all the numbers and the corresponding labels in a df
library(utils)
attributes2009party <- stack(attr(subset_2009$q4, 'labels'))

#Creating a duplicate df of the attribute DF
newA2009P <- as.data.frame(attributes2009party)

#Make the labels as.character instead of weird format
newA2009P$ind <- as.character(newA2009P$ind)

#Doing the same for the subset data and making the numbers as.numeric for the 'party' question. This will make the loop easier run. 
newS2009 <- as.data.frame(subset_2009)
newS2009$q4 <- as.numeric(newS2009$q4)

#Make a function that inserts party-labels back into the dataframe 
for (i in 1:nrow(subset_2009)){
  labelvalue1 <- newS2009$q4[i]
  for (j in 1:nrow(attributes2009party)){
    labelvalue2 <- newA2009P$values[j]
    labelname <- newA2009P$ind[j]
    #If the number in q4 in the subset matches a number in the attribute df -     insert the corresponding label into a new column next to the number
    if (labelvalue1 == labelvalue2) {
      #Insert the new row with labels into the subset_2009 df
      subset_2009$partyname[i] <- labelname
    }
  }
}

#Make a column with the labels of the most important problem
attributes2009 <- stack(attr(subset_2009$q1, 'labels'))
newS2009$q1 <- as.numeric(newS2009$q1)
newA2009 <- as.data.frame(attributes2009)
newA2009$ind <- as.character(newA2009$ind)
subset_2009$MIP_label <- 0

#Function to insert labels of MIP into the dataset
for (i in 1:nrow(subset_2009)){
  labelvalue3 <- newS2009$q1[i]
  for (j in 1:nrow(attributes2009)){
    labelvalue4 <- newA2009$values[j]
    labelname1 <- newA2009$ind[j]
    #If the number in q4 in the subset matches a number in the attribute df -     insert the corresponding label into a new column next to the number
    if (labelvalue3 == labelvalue4) {
      #Insert the new row with labels into the subset_2009 df
      subset_2009$MIP_label[i] <- labelname1
    }
  }
}

#Make an if-statement that puts 1 into all climate-related problems and 0 into non-climate related problems (for the MIP)
subset_2009$MIP_climate <- 0

for (i in 1:nrow(subset_2009)){
  if (newS2009$q1[i] == 2 || newS2009$q1[i] == 8 || newS2009$q1[i] == 86 || newS2009$q1[i] == 87) {
    subset_2009$MIP_climate[i] <- 1
  }
  else {
    subset_2009$MIP_climate[i] <- 0
  }
}

#Make a dummy variable with 1 if respondents named climate as a problem at all and 0 if the did not
subset_2009$climate_in_general <- 0

newS2009$q2 <- as.numeric(newS2009$q2)
newS2009$q3 <- as.numeric(newS2009$q3)

#Check if attributes are the same for all three questions
attributes2009 <- stack(attr(subset_2009$q1, 'labels'))
attributes2009_q2 <- stack(attr(df_2009$q2, 'labels'))
attributes2009_q3 <- stack(attr(df_2009$q3, 'labels'))
#Luckily it is the same
for (i in 1:nrow(subset_2009)){
  if (newS2009$q1[i] == 2 || newS2009$q1[i] == 8 || newS2009$q1[i] == 86 || newS2009$q1[i] == 87 || newS2009$q2[i] == 2 || newS2009$q2[i] == 8 || newS2009$q2[i] == 86 || newS2009$q2[i] == 87 || newS2009$q3[i] == 2 || newS2009$q3[i] == 8 || newS2009$q3[i] == 86 || newS2009$q3[i] == 87) {
    subset_2009$climate_in_general[i] <- 1
  }
  else {
    subset_2009$climate_in_general[i] <- 0
  }
}

write_excel_csv(subset_2009,"/Users/kaspermichelsen/EES_data/2009_test.xlsx")
```


```{r}
#2014
library(haven)
library(tidyverse)
df_2014 = read_sav("ZA5160_v4-0-0.sav")

q1_test <- stack(attr(df_2014$q1_2, 'labels'))

```


```{r}
#1994
library(haven)
library(tidyverse)
df_1994 = read_sav("ZA2865.sav")
df_1994_test <- read_por("ZA2865.por")

q1_test1 <- stack(attr(df_1994$v77, 'labels'))
subset_1994 <- select(df_1994,"id", "country", "v77", "v78", "v79")
```


```{r}
#1999
df_1999 <- read_dta("P1560a.dta")
str(df_1999$var002)
country_1999 <- stack(attr(df_1999$var002, 'labels'))
subset_1999 <- select(df_1999, "var001", "var002", "var013", "var014", "var015", "var016", "var017", "var018", "var019", "var020")

subset_test1999 <- subset_1999
subset_test1999$var002 <- as.numeric(subset_test1999$var002)
country_1999$values <- as.numeric(country_1999$values)
country_1999$ind <- as.character(country_1999$ind)

subset_1999$country_label <- 0
#Inserting country-label
for (i in 1:nrow(subset_1999)){
  labelvalue1999 <- subset_test1999$var002[i]
  for (j in 1:nrow(country_1999)){
    labelvalue1999_2 <- country_1999$values[j]
    labelname1999 <- country_1999$ind[j]
    #If the number in q4 in the subset matches a number in the attribute df -     insert the corresponding label into a new column next to the number
    if (labelvalue1999 == labelvalue1999_2) {
      #Insert the new row with labels into the subset_2009 df
      subset_1999$country_label[i] <- labelname1999
    }
  }
}

#MIP loop
subset_1999$MIP_climate <- 0

for (i in 1:nrow(subset_1999)){
  if (subset_test1999$var013[i] == 60 || subset_test1999$var013[i] == 61) {
    subset_1999$MIP_climate[i] <- 1
  }
  else {
    subset_1999$MIP_climate[i] <- 0
  }
}

party_1999 <- stack(attr(df_1999$var020, 'labels'))
str(subset_1999$var020)
subset_test1999$var020[3]
install.packages("readxl")
library(readxl)
#Made a sheet in excel with all the parties for the different countries with a corresponding value
subset_test1999 <- subset_1999
subset_test1999$var020 <- unclass(subset_test1999$var020)
subset_test1999$var020 <- as.numeric(subset_test1999$var020)
subset_1999$Party_name <- 0
party_1999_new <- read_xlsx("partier_1999.xlsx")

colnames(party_1999_new[1])

for (i in 1:nrow(subset_test1999)) {
  partyValue <- subset_test1999$var020[i]
  if (subset_test1999$country_label[i] == "Austria") {
    for (j in 1:nrow(party_1999_new)) {
      partyIndex <- party_1999_new$Value[j]
      partyname <- party_1999_new$Austria[j]
      if (partyValue == partyIndex){
         subset_1999$Party_name[i] <- partyname
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "UK") {
    for (uk in 1:nrow(party_1999_new)) {
      partyIndex1 <- party_1999_new$Value[uk]
      partyname1 <- party_1999_new$UK[uk]
      if (partyValue == partyIndex1){
         subset_1999$Party_name[i] <- partyname1
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Belgium") {
    for (bel in 1:nrow(party_1999_new)) {
      partyIndex2 <- party_1999_new$Value[bel]
      partyname2 <- party_1999_new$`Belgium-Flanders`[bel]
      if (partyValue == partyIndex2){
         subset_1999$Party_name[i] <- partyname2
      }
        
    }
  } 
  else if (subset_test1999$country_label[i] == "Denmark") {
    for (dk in 1:nrow(party_1999_new)) {
      partyIndex3 <- party_1999_new$Value[dk]
      partyname3 <- party_1999_new$Denmark[dk]
      if (partyValue == partyIndex3){
         subset_1999$Party_name[i] <- partyname3
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Germany") {
    for (ger in 1:nrow(party_1999_new)) {
      partyIndex4 <- party_1999_new$Value[ger]
      partyname4 <- party_1999_new$Germany[ger]
      if (partyValue == partyIndex4){
         subset_1999$Party_name[i] <- partyname4
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Finland") {
    for (fin in 1:nrow(party_1999_new)) {
      partyIndex5 <- party_1999_new$Value[fin]
      partyname5 <- party_1999_new$Finland[fin]
      if (partyValue == partyIndex5){
         subset_1999$Party_name[i] <- partyname5
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Sweden") {
    for (swe in 1:nrow(party_1999_new)) {
      partyIndex6 <- party_1999_new$Value[swe]
      partyname6 <- party_1999_new$Sweden[swe]
      if (partyValue == partyIndex6){
         subset_1999$Party_name[i] <- partyname6
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Spain") {
    for (sp in 1:nrow(party_1999_new)) {
      partyIndex7 <- party_1999_new$Value[sp]
      partyname7 <- party_1999_new$Spain[sp]
      if (partyValue == partyIndex7){
         subset_1999$Party_name[i] <- partyname7
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Greece") {
    for (gr in 1:nrow(party_1999_new)) {
      partyIndex8 <- party_1999_new$Value[gr]
      partyname8 <- party_1999_new$Greece[gr]
      if (partyValue == partyIndex8){
         subset_1999$Party_name[i] <- partyname8
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "France") {
    for (fr in 1:nrow(party_1999_new)) {
      partyIndex9 <- party_1999_new$Value[fr]
      partyname9 <- party_1999_new$France[fr]
      if (partyValue == partyIndex9){
         subset_1999$Party_name[i] <- partyname9
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Ireland") {
    for (ire in 1:nrow(party_1999_new)) {
      partyIndex10 <- party_1999_new$Value[ire]
      partyname10 <- party_1999_new$Ireland[ire]
      if (partyValue == partyIndex10){
         subset_1999$Party_name[i] <- partyname10
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Luxemburg") {
    for (lu in 1:nrow(party_1999_new)) {
      partyIndex11 <- party_1999_new$Value[lu]
      partyname11 <- party_1999_new$Luxembourg[lu]
      if (partyValue == partyIndex11){
         subset_1999$Party_name[i] <- partyname11
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Netherlands") {
    for (net in 1:nrow(party_1999_new)) {
      partyIndex12 <- party_1999_new$Value[net]
      partyname12 <- party_1999_new$Netherlands[net]
      if (partyValue == partyIndex12){
         subset_1999$Party_name[i] <- partyname12
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Italy") {
    for (it in 1:nrow(party_1999_new)) {
      partyIndex13 <- party_1999_new$Value[it]
      partyname13 <- party_1999_new$Italy[it]
      if (partyValue == partyIndex13){
         subset_1999$Party_name[i] <- partyname13
      }
        
    }
  }
  else if (subset_test1999$country_label[i] == "Portugal") {
    for (por in 1:nrow(party_1999_new)) {
      partyIndex14 <- party_1999_new$Value[por]
      partyname14 <- party_1999_new$Portugal[por]
      if (partyValue == partyIndex14){
         subset_1999$Party_name[i] <- partyname14
      }
        
    }
  }
}
  
    
```

## R Markdown


This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
